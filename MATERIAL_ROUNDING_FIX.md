# üî¢ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞:
**–ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Å–ø–∏—Å—ã–≤–∞–ª–∏—Å—å –¥—Ä–æ–±–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏, —á—Ç–æ –Ω–µ—É–¥–æ–±–Ω–æ –¥–ª—è —É—á–µ—Ç–∞.**

## ‚úÖ –†–µ—à–µ–Ω–∏–µ:
**–î–æ–±–∞–≤–ª–µ–Ω–æ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö –¥–æ —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö —Å–ø–∏—Å–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.**

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è:

### 1. **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∑–∞–∫–∞–∑–æ–≤** (`backend/src/controllers/orderItemController.ts`)

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–∞:
```typescript
// –ë—ã–ª–æ:
const needQty = n.qtyPerItem * Math.max(1, Number(quantity) || 1)

// –°—Ç–∞–ª–æ:
const needQty = Math.ceil(n.qtyPerItem * Math.max(1, Number(quantity) || 1)) // –û–∫—Ä—É–≥–ª—è–µ–º –≤–≤–µ—Ä—Ö –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–∑–∏—Ü–∏–∏:
```typescript
// –ë—ã–ª–æ:
const need = (c.qtyPerItem || 0) * deltaQty
const back = (c.qtyPerItem || 0) * Math.abs(deltaQty)

// –°—Ç–∞–ª–æ:
const need = Math.ceil((c.qtyPerItem || 0) * deltaQty) // –û–∫—Ä—É–≥–ª—è–µ–º –≤–≤–µ—Ä—Ö –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞
const back = Math.ceil((c.qtyPerItem || 0) * Math.abs(deltaQty)) // –û–∫—Ä—É–≥–ª—è–µ–º –≤–≤–µ—Ä—Ö –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞
```

#### –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–∞:
```typescript
// –ë—ã–ª–æ:
const returnQty = (c.qtyPerItem || 0) * Math.max(1, Number(it.quantity) || 1)

// –°—Ç–∞–ª–æ:
const returnQty = Math.ceil((c.qtyPerItem || 0) * Math.max(1, Number(it.quantity) || 1)) // –û–∫—Ä—É–≥–ª—è–µ–º –≤–≤–µ—Ä—Ö –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞
```

### 2. **–°–µ—Ä–≤–∏—Å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤** (`backend/src/services/materialService.ts`)

```typescript
// –ë—ã–ª–æ:
await db.run('UPDATE materials SET quantity = quantity + ? WHERE id = ?', Number(delta), Number(materialId))

// –°—Ç–∞–ª–æ:
const roundedDelta = Math.ceil(Number(delta)) // –û–∫—Ä—É–≥–ª—è–µ–º –≤–≤–µ—Ä—Ö –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞
await db.run('UPDATE materials SET quantity = quantity + ? WHERE id = ?', roundedDelta, Number(materialId))
```

### 3. **–°–µ—Ä–≤–∏—Å –∑–∞–∫–∞–∑–æ–≤** (`backend/src/services/orderService.ts`)

#### –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:
```typescript
// –ë—ã–ª–æ:
const add = (c.qtyPerItem || 0) * Math.max(1, Number(item.quantity) || 1)

// –°—Ç–∞–ª–æ:
const add = Math.ceil((c.qtyPerItem || 0) * Math.max(1, Number(item.quantity) || 1)) // –û–∫—Ä—É–≥–ª—è–µ–º –≤–≤–µ—Ä—Ö –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞
```

#### –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:
```typescript
// –ë—ã–ª–æ:
const addQty = returns[materialId]

// –°—Ç–∞–ª–æ:
const addQty = Math.ceil(returns[materialId]) // –û–∫—Ä—É–≥–ª—è–µ–º –≤–≤–µ—Ä—Ö –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

### ‚úÖ **–¢–µ—Å—Ç –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:**
- **–°–æ–∑–¥–∞–Ω –∑–∞–∫–∞–∑** —Å –ø–æ–∑–∏—Ü–∏–µ–π –ª–∏—Å—Ç–æ–≤–æ–∫
- **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏—è** —Å –¥—Ä–æ–±–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- **–ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –¥–≤–∏–∂–µ–Ω–∏—è** –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ - –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ü–µ–ª—ã–µ
- **–û—Å—Ç–∞—Ç–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤** –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏:**
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–ø–∏—Å–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `Math.ceil()`
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `Math.ceil()`
- –í—Å–µ –¥–≤–∏–∂–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ü–µ–ª—ã–º–∏ —á–∏—Å–ª–∞–º–∏

## üéØ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

1. **–£–¥–æ–±—Å—Ç–≤–æ —É—á–µ—Ç–∞** - –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ü–µ–ª—ã–º–∏ —á–∏—Å–ª–∞–º–∏
2. **–¢–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–æ–≤** - –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
3. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –ª–æ–≥–∏–∫—É
4. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è** - —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞ –ª–µ–≥—á–µ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å

## üìã **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**

1. **`backend/src/controllers/orderItemController.ts`**
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –∑–∞–∫–∞–∑–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–∑–∏—Ü–∏–π
   - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –∑–∞–∫–∞–∑–∞

2. **`backend/src/services/materialService.ts`**
   - –°–ø–∏—Å–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

3. **`backend/src/services/orderService.ts`**
   - –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
   - –í–æ–∑–≤—Ä–∞—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

## üöÄ **–°—Ç–∞—Ç—É—Å:**

**‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!**
- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ü–µ–ª—ã–º–∏ —á–∏—Å–ª–∞–º–∏
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã

## üß™ **–ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
node test-material-rounding.js

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
curl -H "Authorization: Bearer admin-token-123" http://localhost:3001/api/materials

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
curl -H "Authorization: Bearer admin-token-123" http://localhost:3001/api/materials/moves
```

**–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ**
